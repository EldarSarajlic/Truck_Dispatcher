<div class="flex flex-col gap-10">

  <!-- ================= LOADING ================= -->
  <ng-container *ngIf="isLoading">
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6">
      <div
        class="card bg-base-100 shadow p-6"
        *ngFor="let i of [1,2,3,4]"
      >
        <div class="skeleton h-5 w-24 mb-4"></div>
        <div class="skeleton h-10 w-32 mb-2"></div>
        <div class="skeleton h-4 w-20"></div>
      </div>
    </div>
  </ng-container>

  <!-- ================= ERROR ================= -->
  <div *ngIf="error" class="alert alert-error shadow">
    <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24"
         stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round"
            d="M12 9v2m0 4h.01
               M10.29 3.86l-8.02 14
               A1 1 0 003.14 19h17.72
               a1 1 0 00.87-1.5l-8.02-14
               a1 1 0 00-1.74 0z"/>
    </svg>
    <span>{{ error }}</span>
  </div>

  <!-- ================= DASHBOARD OVERVIEW ================= -->
  <ng-container *ngIf="!isLoading && dashboardStats as stats">

    <!-- ================= METRICS ================= -->
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6">

      <!-- TOTAL SALES -->
      <div class="card bg-base-100 shadow">
        <div class="card-body flex-row items-center gap-4">
          <div class="w-14 h-14 rounded-full bg-blue-500/10 text-blue-600 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8"
                 fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M14 4a6 6 0 00-6 6v4a6 6 0 006 6m-8-6h8m-8-4h8"/>
            </svg>
          </div>

          <div>
            <div class="text-sm font-medium text-base-content/80">Total Sales</div>
            <div class="text-2xl font-bold">
              {{ stats.totalSales | currency:'EUR':'symbol':'1.0-0' }}
            </div>
          </div>
        </div>
      </div>

      <!-- TOTAL ORDERS -->
      <div class="card bg-base-100 shadow">
        <div class="card-body flex-row items-center gap-4">
          <div class="w-14 h-14 rounded-full bg-emerald-500/10 text-emerald-600 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8"
                 fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M9 12h6m-6 4h6m-7 4h8
                       a2 2 0 002-2V6a2 2 0 00-2-2H8a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
          </div>

          <div>
            <div class="text-sm font-medium text-base-content/80">Total Orders</div>
            <div class="text-2xl font-bold">{{ stats.totalOrders }}</div>
          </div>
        </div>
      </div>

      <!-- TOTAL USERS -->
      <div class="card bg-base-100 shadow">
        <div class="card-body flex-row items-center gap-4">
          <div class="w-14 h-14 rounded-full bg-violet-500/10 text-violet-600 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8"
                 fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M17 20h5v-2a4 4 0 00-4-4h-1
                       M9 20H4v-2a4 4 0 014-4h1
                       m4-4a4 4 0 100-8 4 4 0 000 8z"/>
            </svg>
          </div>

          <div>
            <div class="text-sm font-medium text-base-content/80">Total Users</div>
            <div class="text-2xl font-bold">{{ stats.totalUsers }}</div>
          </div>
        </div>
      </div>

      <!-- PENDING ORDERS -->
      <div class="card bg-base-100 shadow">
        <div class="card-body flex-row items-center gap-4">
          <div class="w-14 h-14 rounded-full bg-amber-500/10 text-amber-600 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8"
                 fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 9v2m0 4h.01
                       M10.29 3.86l-8.02 14
                       A1 1 0 003.14 19h17.72
                       a1 1 0 00.87-1.5l-8.02-14
                       a1 1 0 00-1.74 0z"/>
            </svg>
          </div>

          <div>
            <div class="text-sm font-medium text-base-content/80">Pending Orders</div>
            <div class="text-2xl font-bold">{{ stats.pendingOrders }}</div>
          </div>
        </div>
      </div>

    </div>

    <!-- ================= RECENT ORDERS ================= -->
    <div class="card bg-base-100 shadow">
      <div class="card-body">

        <h3 class="text-lg font-semibold mb-4">
          Recent Orders (last 7 days)
        </h3>

        <!-- EMPTY -->
        <div *ngIf="stats.recentOrders.length === 0"
             class="text-center text-base-content/60 py-10">
          No recent orders
        </div>

        <!-- LIST -->
        <div *ngIf="stats.recentOrders.length > 0"
             class="divide-y divide-base-content/10">

          <div
            *ngFor="let sale of stats.recentOrders"
            (click)="openOrderModal(sale)"
            class="flex items-center justify-between py-4 px-3
                   rounded-lg cursor-pointer
                   hover:bg-base-200 transition">

            <!-- LEFT -->
            <div class="flex items-center gap-3">
              <span
                class="w-2.5 h-2.5 rounded-full"
                [ngClass]="{
                  'bg-success': sale.status === 'Approved',
                  'bg-primary': sale.status === 'InProgress',
                  'bg-info': sale.status === 'Completed',
                  'bg-warning': sale.status === 'Pending',
                  'bg-error': sale.status === 'Cancelled'
                }"
              ></span>

              <div>
                <div class="font-semibold">{{ sale.reference }}</div>
                <div class="text-sm text-base-content/70">
                  {{ sale.client }}
                </div>
              </div>
            </div>

            <!-- RIGHT -->
            <div class="text-right">
              <div class="font-bold text-success">
                {{ sale.price | currency:'EUR' }}
              </div>
              <div class="text-xs text-base-content/60">
                {{ sale.date | date:'dd.MM.yyyy HH:mm' }}
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

  </ng-container>
</div>
<!-- ================= MODAL ================= -->
<dialog class="modal" [open]="selectedOrder">
  <div class="modal-box max-w-2xl ">

    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold">
        Order {{ selectedOrder?.reference }}
      </h3>
      <button class="btn btn-sm btn-circle btn-ghost"
              (click)="closeOrderModal()">âœ•</button>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">

      <div>
        <span class="font-medium">Client</span>
        <div>{{ selectedOrder?.client }}</div>
      </div>

      <div>
        <span class="font-medium">Status</span>
        <div class="mt-1">
          <span class="badge"
            [ngClass]="{
              'badge-success': selectedOrder?.status === 'Approved',
              'badge-primary': selectedOrder?.status === 'InProgress',
              'badge-info': selectedOrder?.status === 'Completed',
              'badge-warning': selectedOrder?.status === 'Pending',
              'badge-error': selectedOrder?.status === 'Cancelled'
            }">
            {{ selectedOrder?.status }}
          </span>
        </div>
      </div>

      <div>
        <span class="font-medium">Order Date</span>
        <div>
          {{ selectedOrder?.date | date:'dd.MM.yyyy HH:mm' }}
        </div>
      </div>

      <div>
        <span class="font-medium">Total Amount</span>
        <div class="font-semibold text-success">
          {{ selectedOrder?.price | currency:'EUR' }}
        </div>
      </div>

    </div>

    <div class="modal-action mt-6">
      <button class="btn btn-outline" (click)="closeOrderModal()">Close</button>
      <button *ngIf="selectedOrder?.status === 'Pending'"
              class="btn btn-success">
        Approve Order
      </button>
      <button class="btn btn-primary">
        View Full Order
      </button>
    </div>

  </div>

  <form method="dialog" class="modal-backdrop">
    <button (click)="closeOrderModal()">close</button>
  </form>
</dialog>
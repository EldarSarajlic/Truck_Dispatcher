<!-- DaisyUI modal: visible when open=true -->
<div class="modal" [class.modal-open]="open">
  <div class="modal-box w-11/12 max-w-3xl">

    <!-- Header -->
    <div class="flex items-center justify-between gap-4 mb-4">
      <h3 class="font-bold text-lg">{{ title }}</h3>
      <button type="button" class="btn btn-sm btn-ghost" (click)="onClose()">âœ•</button>
    </div>

    <!-- Form -->
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-5">

      <!-- License plate / VIN -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- License Plate -->
        <label class="form-control w-full">
          <div class="label">
            <span class="label-text">License Plate Number</span>
          </div>
          <input class="input input-bordered w-full" formControlName="licensePlateNumber" />
          <div class="label" *ngIf="form.get('licensePlateNumber')?.touched && form.get('licensePlateNumber')?.invalid">
            <span class="label-text-alt text-error">Required</span>
          </div>
        </label>

        <!-- VIN -->
        <label class="form-control w-full">
          <div class="label">
            <span class="label-text">VIN Number</span>
          </div>
          <input class="input input-bordered w-full" formControlName="vinNumber" />
          <div class="label" *ngIf="form.get('vinNumber')?.touched && form.get('vinNumber')?.invalid">
            <span class="label-text-alt text-error">Required</span>
          </div>
        </label>
      </div>

      <!-- Make / Model -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Make -->
        <label class="form-control w-full">
          <div class="label">
            <span class="label-text">Make</span>
          </div>
          <input class="input input-bordered w-full" formControlName="make" />
          <div class="label" *ngIf="form.get('make')?.touched && form.get('make')?.invalid">
            <span class="label-text-alt text-error">Required</span>
          </div>
        </label>

        <!-- Model -->
        <label class="form-control w-full">
          <div class="label">
            <span class="label-text">Model</span>
          </div>
          <input class="input input-bordered w-full" formControlName="model" />
          <div class="label" *ngIf="form.get('model')?.touched && form.get('model')?.invalid">
            <span class="label-text-alt text-error">Required</span>
          </div>
        </label>
      </div>

      <!-- Year / Capacity / GPS -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- Year -->
        <label class="form-control w-full">
          <div class="label">
            <span class="label-text">Year</span>
          </div>
          <input type="number" class="input input-bordered w-full" formControlName="year" />
          <div class="label" *ngIf="form.get('year')?.touched && form.get('year')?.invalid">
            <span class="label-text-alt text-error">Invalid year</span>
          </div>
        </label>

        <!-- Capacity -->
        <label class="form-control w-full">
          <div class="label">
            <span class="label-text">Capacity (tons)</span>
          </div>
          <input type="number" step="0.1" class="input input-bordered w-full" formControlName="capacity" />
          <div class="label" *ngIf="form.get('capacity')?.touched && form.get('capacity')?.invalid">
            <span class="label-text-alt text-error">Invalid</span>
          </div>
        </label>

        <!-- GPS Device Id -->
        <label class="form-control w-full">
          <div class="label">
            <span class="label-text">GPS Device Id</span>
          </div>
          <input class="input input-bordered w-full" formControlName="gpsDeviceId" />
        </label>
      </div>

      <!-- Engine / kW / Status -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- Engine Capacity -->
        <label class="form-control w-full">
          <div class="label">
            <span class="label-text">Engine Capacity</span>
          </div>
          <input type="number" class="input input-bordered w-full" formControlName="engineCapacity" />
          <div class="label" *ngIf="form.get('engineCapacity')?.touched && form.get('engineCapacity')?.invalid">
            <span class="label-text-alt text-error">Invalid</span>
          </div>
        </label>

        <!-- kW -->
        <label class="form-control w-full">
          <div class="label">
            <span class="label-text">kW</span>
          </div>
          <input type="number" class="input input-bordered w-full" formControlName="kw" />
          <div class="label" *ngIf="form.get('kw')?.touched && form.get('kw')?.invalid">
            <span class="label-text-alt text-error">Invalid</span>
          </div>
        </label>

        <!-- Vehicle Status -->
        <label class="form-control w-full">
          <div class="label">
            <span class="label-text">Vehicle Status</span>
          </div>
          <select class="select select-bordered w-full" formControlName="vehicleStatusId">
            <option [ngValue]="null" disabled>Select status</option>
            <option *ngFor="let s of statusOptions" [ngValue]="s.id">
              {{ s.statusName }}
            </option>
          </select>
          <div class="label" *ngIf="form.get('vehicleStatusId')?.touched && form.get('vehicleStatusId')?.invalid">
            <span class="label-text-alt text-error">Required</span>
          </div>
        </label>
      </div>

      <!-- Dates: Last / Next Maintenance -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Last Maintenance Date -->
        <div class="form-control w-full">
          <div class="label">
            <span class="label-text">Last Maintenance Date</span>
          </div>

          <div class="relative">
            <!-- vidljivi input -->
            <input
              class="input input-bordered w-full pr-10"
              [readonly]="isView"
              [value]="form.get('lastMaintenanceDate')?.value | date : 'MM/dd/yyyy'"
              (change)="onDateTextChange($event.target.value, 'lastMaintenanceDate')"
              placeholder="MM/DD/YYYY"
            />

            <!-- ikonica kalendara -->
            <button
              type="button"
              class="btn btn-ghost btn-xs absolute right-2 top-1/2 -translate-y-1/2"
              [disabled]="isView"
              (click)="lastPicker.open()"
            >
              <mat-icon fontIcon="calendar_today"></mat-icon>
            </button>

            <!-- skriveni mat-form-field samo za datepicker anchor -->
            <mat-form-field
              appearance="fill"
              class="!absolute !opacity-0 !pointer-events-none"
            >
              <input
                matInput
                [matDatepicker]="lastPicker"
                (dateChange)="onDatePicked($event.value, 'lastMaintenanceDate')"
              />
              <mat-datepicker #lastPicker></mat-datepicker>
            </mat-form-field>
          </div>
        </div>

        <!-- Next Maintenance Date -->
        <div class="form-control w-full">
          <div class="label">
            <span class="label-text">Next Maintenance Date</span>
          </div>

          <div class="relative">
            <input
              class="input input-bordered w-full pr-10"
              [readonly]="isView"
              [value]="form.get('nextMaintenanceDate')?.value | date : 'MM/dd/yyyy'"
              (change)="onDateTextChange($event.target.value, 'nextMaintenanceDate')"
              placeholder="MM/DD/YYYY"
            />

            <button
              type="button"
              class="btn btn-ghost btn-xs absolute right-2 top-1/2 -translate-y-1/2"
              [disabled]="isView"
              (click)="nextPicker.open()"
            >
              <mat-icon fontIcon="calendar_today"></mat-icon>
            </button>

            <mat-form-field
              appearance="fill"
              class="!absolute !opacity-0 !pointer-events-none"
            >
              <input
                matInput
                [matDatepicker]="nextPicker"
                (dateChange)="onDatePicked($event.value, 'nextMaintenanceDate')"
              />
              <mat-datepicker #nextPicker></mat-datepicker>
            </mat-form-field>
          </div>
        </div>
      </div>

      <!-- Dates: Registration / Insurance -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Registration Expiration -->
        <div class="form-control w-full">
          <div class="label">
            <span class="label-text">Registration Expiration</span>
          </div>

          <div class="relative">
            <input
              class="input input-bordered w-full pr-10"
              [readonly]="isView"
              [value]="form.get('registrationExpiration')?.value | date : 'MM/dd/yyyy'"
              (change)="onDateTextChange($event.target.value, 'registrationExpiration')"
              placeholder="MM/DD/YYYY"
            />

            <button
              type="button"
              class="btn btn-ghost btn-xs absolute right-2 top-1/2 -translate-y-1/2"
              [disabled]="isView"
              (click)="registrationPicker.open()"
            >
              <mat-icon fontIcon="calendar_today"></mat-icon>
            </button>

            <mat-form-field
              appearance="fill"
              class="!absolute !opacity-0 !pointer-events-none"
            >
              <input
                matInput
                [matDatepicker]="registrationPicker"
                (dateChange)="onDatePicked($event.value, 'registrationExpiration')"
              />
              <mat-datepicker #registrationPicker></mat-datepicker>
            </mat-form-field>
          </div>
        </div>

        <!-- Insurance Expiration -->
        <div class="form-control w-full">
          <div class="label">
            <span class="label-text">Insurance Expiration</span>
          </div>

          <div class="relative">
            <input
              class="input input-bordered w-full pr-10"
              [readonly]="isView"
              [value]="form.get('insuranceExpiration')?.value | date : 'MM/dd/yyyy'"
              (change)="onDateTextChange($event.target.value, 'insuranceExpiration')"
              placeholder="MM/DD/YYYY"
            />

            <button
              type="button"
              class="btn btn-ghost btn-xs absolute right-2 top-1/2 -translate-y-1/2"
              [disabled]="isView"
              (click)="insurancePicker.open()"
            >
              <mat-icon fontIcon="calendar_today"></mat-icon>
            </button>

            <mat-form-field
              appearance="fill"
              class="!absolute !opacity-0 !pointer-events-none"
            >
              <input
                matInput
                [matDatepicker]="insurancePicker"
                (dateChange)="onDatePicked($event.value, 'insuranceExpiration')"
              />
              <mat-datepicker #insurancePicker></mat-datepicker>
            </mat-form-field>
          </div>
        </div>
      </div>

      <!-- Footer buttons -->
      <div class="modal-action">
        <button type="button" class="btn" (click)="onClose()">Close</button>

        <button *ngIf="!isView" type="submit" class="btn btn-primary">
          Save
        </button>
      </div>
    </form>

  </div>

  <!-- click outside to close -->
  <div class="modal-backdrop" (click)="onClose()"></div>
</div>